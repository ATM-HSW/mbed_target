
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=cp1252" />
    <title>11.1.1. PowerSTEP01_Config</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="next" title="11.1.2. PowerSTEP01_GetAcceleration" href="PowerSTEP01_GetAcceleration_en.html" />
    <link rel="prev" title="11.1. PowerSTEP01" href="_PowerSTEP01_en.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="PowerSTEP01_GetAcceleration_en.html" title="11.1.2. PowerSTEP01_GetAcceleration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="_PowerSTEP01_en.html" title="11.1. PowerSTEP01"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../Index.html">mbed_target_doc 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="_index_en.html" >11. Motor Driver</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="_PowerSTEP01_en.html" accesskey="U">11.1. PowerSTEP01</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="powerstep01-config">
<h1>11.1.1. PowerSTEP01_Config</h1>
<div class="section" id="description">
<h2>11.1.1.1. Description</h2>
<p>This block configures up to three stepper motor drivers on a single SPI bus.
The stepper motor driver IC powerSTEP01 and L6470 are supported.
With this block you can make all the necessary settings for the motor driver.
Each model that uses this block also needs an “SPI Master Config” block.</p>
<a class="reference internal image-reference" href="../_images/powerSTEP01_Config_block.png"><img alt="../_images/powerSTEP01_Config_block.png" src="../_images/powerSTEP01_Config_block.png" style="width: 250px;" /></a>
</div>
<div class="section" id="parameters-and-dialog-box">
<h2>11.1.1.2. Parameters and Dialog Box</h2>
<img alt="../_images/powerSTEP01_Config_Mask.png" src="../_images/powerSTEP01_Config_Mask.png" />
<div class="section" id="spi-port">
<h3>SPI Port</h3>
<p>specify the SPI port number that should be used by the block.</p>
</div>
<div class="section" id="ssel-port-pin">
<h3>SSEL Port/Pin</h3>
<p>specify the mcu pin which is connected to the chip select pin from the driver. This block supports the naming schema: ‘P’ + letter ‘A’, ‘B’, ‘C’, … + ‘_’ + number ‘0’, ‘1’, … ‘15’, e.g. PA_0.</p>
</div>
<div class="section" id="reset-port-pin">
<h3>Reset Port/Pin</h3>
<p>specify the mcu pin which is connected to the reset pin from the driver. This block supports the naming schema: ‘P’ + letter ‘A’, ‘B’, ‘C’, … + ‘_’ + number ‘0’, ‘1’, … ‘15’, e.g. PA_0.</p>
</div>
<div class="section" id="motor-2-3-active">
<h3>Motor 2/3 active</h3>
<p>The checkbox “Motor 2 active” and “Motor 3 active” determine how many motors are connected to the SPI bus (Daisychain). “Motor 3 active” should only be activated if “Motor 2 active” is already been activated.</p>
</div>
<div class="section" id="acc">
<h3>ACC</h3>
<p>specifies the acceleration rate in [step/s^2]. The value for the acceleration rate must be in the range from 14.55 to 59590 step/s^2.</p>
</div>
<div class="section" id="dec">
<h3>DEC</h3>
<p>specifies the deceleration rate in [step/s^2]. The value for the deceleration rate must be in the range from 14.55 to 59590 step/s^2.</p>
</div>
<div class="section" id="max-speed">
<h3>Max Speed</h3>
<p>specifies the maximum speed in [step/s]. The value for the maximum speed must be in the range from 15.25 to 15610 step/s.</p>
</div>
<div class="section" id="min-speed">
<h3>Min Speed</h3>
<p>specifies the minimum speed in [step/s]. The value for the minimum speed must be in the range from 0 to 976.3 step/s.</p>
</div>
<div class="section" id="full-step-speed">
<h3>Full Step Speed</h3>
<p>specifies the full step speed in [step/s]. The value for the full step speed must be in the range from 7.63 to 15625 step/s.</p>
</div>
<div class="section" id="overcurrent">
<h3>Overcurrent</h3>
<p>specifies the overcurrent threshold for the driver in [mV].
The value for the overcurrent threshold must be in the range from 31.25 to 1000 mV and in steps of 31.25 mV.
The real current in the motor is calculated as follows:</p>
<blockquote>
<div>I <sub>motor</sub> = U <sub>Overcurrent_threshold</sub> / R <sub>shunt</sub></div></blockquote>
</div>
<div class="section" id="step-mode">
<h3>Step Mode</h3>
<p>specifies the step mode of the driver (microstepping ). The possible values correspond to the values defined in the StepperMotor class:</p>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Step mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>STEP_MODE_FULL</td>
<td>Full-step</td>
</tr>
<tr class="row-odd"><td>STEP_MODE_HALF</td>
<td>Half-step</td>
</tr>
<tr class="row-even"><td>STEP_MODE_1_4</td>
<td>1/4 microstep</td>
</tr>
<tr class="row-odd"><td>STEP_MODE_1_8</td>
<td>1/8 microstep</td>
</tr>
<tr class="row-even"><td>STEP_MODE_1_16</td>
<td>1/16 microstep</td>
</tr>
<tr class="row-odd"><td>STEP_MODE_1_32</td>
<td>1/32 microstep</td>
</tr>
<tr class="row-even"><td>STEP_MODE_1_64</td>
<td>1/64 microstep</td>
</tr>
<tr class="row-odd"><td>STEP_MODE_1_128</td>
<td>1/128 microstep</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hold-torque">
<h3>Hold torque</h3>
<p>specifies the hold torque in [mV]. The value for the hold torque must be in the range from 7.8 to 1000 mV.
The real current in the motor is calculated as follows:</p>
<blockquote>
<div>I <sub>motor</sub> = U <sub>Hold_torque_threshold</sub> / R <sub>shunt</sub></div></blockquote>
</div>
<div class="section" id="run-torque">
<h3>Run torque</h3>
<p>specifies the run torque in [mV]. The value for the run torque must be in the range from 7.8 to 1000 mV.
The real current in the motor is calculated as follows:</p>
<blockquote>
<div>I <sub>motor</sub> = U <sub>Run_torque_threshold</sub> / R <sub>shunt</sub></div></blockquote>
</div>
<div class="section" id="acc-torque">
<h3>ACC torque</h3>
<p>specifies the acceleration torque in [mV]. The value for the acceleration torque must be in the range from 7.8 to 1000 mV.
The real current in the motor is calculated as follows:</p>
<blockquote>
<div>I <sub>motor</sub> = U <sub>ACC_torque_threshold</sub> / R <sub>shunt</sub></div></blockquote>
</div>
<div class="section" id="dec-torque">
<h3>DEC torque</h3>
<p>specifies the deceleration torque in [mV]. The value for the deceleration torque must be in the range from 7.8 to 1000 mV.
The real current in the motor is calculated as follows:</p>
<blockquote>
<div>I <sub>motor</sub> = U <sub>DEC_torque_threshold</sub> / R <sub>shunt</sub></div></blockquote>
</div>
</div>
<div class="section" id="example">
<h2>11.1.1.3. Example</h2>
<img alt="../_images/powerSTEP01_Config_example.png" src="../_images/powerSTEP01_Config_example.png" />
</div>
<div class="section" id="code-generation">
<h2>11.1.1.4. Code Generation</h2>
<p>The variable, structure and instance names of mbed classes are based on <strong>&lt;name&gt;</strong> created by concatenating model name (, submodelnames) and block name (<strong>&lt;Model Name&gt;</strong>_(<strong>&lt;Subblock Name&gt;</strong>_…)<strong>&lt;Block Name&gt;</strong>). Space and minus characters are substituted by underscore (‘_’) characters.</p>
<div class="section" id="initialization-function">
<h3>Initialization Function</h3>
<p>creates global structures for the motor parameters of each motor</p>
<div class="line-block">
<div class="line">powerstep01_Init_u  powerstep01_Init_u_i_<strong>&lt;name&gt;</strong>;</div>
<div class="line"><br /></div>
<div class="line">powerstep01_Init_u_t  initDeviceParameters_<strong>&lt;name&gt;</strong>_motor_NR   =</div>
<div class="line">{</div>
<div class="line-block">
<div class="line">powerstep01_Init_u_i_<strong>&lt;name&gt;</strong>.cm.cp.cmVmSelection = POWERSTEP01_CM_VM_CURRENT,</div>
<div class="line"><strong>&lt;ACC&gt;</strong>, // Acceleration rate in step/s2, range 14.55 to 59590 steps/s^2</div>
<div class="line"><strong>&lt;DEC&gt;</strong>, // Deceleration rate in step/s2, range 14.55 to 59590 steps/s^2</div>
<div class="line"><strong>&lt;Max Speed&gt;</strong>, // Maximum speed in step/s, range 15.25 to 15610 steps/s</div>
<div class="line"><strong>&lt;Min Speed&gt;</strong>, // Minimum speed in step/s, range 0 to 976.3 steps/s</div>
<div class="line">POWERSTEP01_LSPD_OPT_OFF, // Low speed optimization bit, enum powerstep01_LspdOpt_t</div>
<div class="line"><strong>&lt;Full Step Speed&gt;</strong>, // Full step speed in step/s, range 7.63 to 15625 steps/s</div>
<div class="line">POWERSTEP01_BOOST_MODE_OFF, // Boost of the amplitude square wave, enum powerstep01_BoostMode_t</div>
<div class="line"><strong>&lt;Overcurrent&gt;</strong>, // Overcurrent threshold settings via enum powerstep01_OcdTh_t</div>
<div class="line"><strong>&lt;Step Mode&gt;</strong>, // Step mode settings via enum motorStepMode_t</div>
<div class="line">POWERSTEP01_SYNC_SEL_DISABLED, // Synch. Mode settings via enum powerstep01_SyncSel_t</div>
<div class="line-block">
<div class="line">(POWERSTEP01_ALARM_EN_OVERCURRENT|</div>
<div class="line">POWERSTEP01_ALARM_EN_THERMAL_SHUTDOWN|</div>
<div class="line">POWERSTEP01_ALARM_EN_THERMAL_WARNING|</div>
<div class="line">POWERSTEP01_ALARM_EN_UVLO|</div>
<div class="line">POWERSTEP01_ALARM_EN_STALL_DETECTION|</div>
<div class="line">POWERSTEP01_ALARM_EN_SW_TURN_ON|</div>
<div class="line">POWERSTEP01_ALARM_EN_WRONG_NPERF_CMD), // Alarm settings via bitmap enum powerstep01_AlarmEn_t</div>
</div>
<div class="line">POWERSTEP01_IGATE_64mA, // Gate sink/source current via enum powerstep01_Igate_t</div>
<div class="line">POWERSTEP01_TBOOST_0ns, // Duration of the overboost phase during gate turn-off via enum powerstep01_Tboost_t</div>
<div class="line">POWERSTEP01_TCC_500ns, // Controlled current time via enum powerstep01_Tcc_t</div>
<div class="line">POWERSTEP01_WD_EN_DISABLE, // External clock watchdog, enum powerstep01_WdEn_t</div>
<div class="line">POWERSTEP01_TBLANK_375ns, // Duration of the blanking time via enum powerstep01_TBlank_t</div>
<div class="line">POWERSTEP01_TDT_125ns, // Duration of the dead time via enum powerstep01_Tdt_t</div>
<div class="line"><br /></div>
<div class="line">/* current mode parameters <a href="#id1"><span class="problematic" id="id2">*</span></a>/</div>
<div class="line"><strong>&lt;Hold torque&gt;</strong>, // Hold torque in mV, range from 7.8mV to 1000 mV</div>
<div class="line"><strong>&lt;Run torque&gt;</strong>, // Running torque in mV, range from 7.8mV to 1000 mV</div>
<div class="line"><strong>&lt;ACC torque&gt;</strong>, // Acceleration torque in mV, range from 7.8mV to 1000 mV</div>
<div class="line"><strong>&lt;DEC torque&gt;</strong>, // Deceleration torque in mV, range from 7.8mV to 1000 mV</div>
<div class="line">POWERSTEP01_TOFF_FAST_8us, //Maximum fast decay time , enum powerstep01_ToffFast_t</div>
<div class="line">POWERSTEP01_FAST_STEP_12us, //Maximum fall step time , enum powerstep01_FastStep_t</div>
<div class="line">3.0, // Minimum on-time in us, range 0.5us to 64us</div>
<div class="line">21.0, // Minimum off-time in us, range 0.5us to 64us</div>
<div class="line">POWERSTEP01_CONFIG_INT_16MHZ_OSCOUT_2MHZ, // Clock setting , enum powerstep01_ConfigOscMgmt_t</div>
<div class="line">POWERSTEP01_CONFIG_SW_HARD_STOP, // External switch hard stop interrupt mode, enum powerstep01_ConfigSwMode_t</div>
<div class="line">POWERSTEP01_CONFIG_TQ_REG_TVAL_USED, // External torque regulation enabling , enum powerstep01_ConfigEnTqReg_t</div>
<div class="line">POWERSTEP01_CONFIG_VS_COMP_DISABLE, // Motor Supply Voltage Compensation enabling , enum powerstep01_ConfigEnVscomp_t</div>
<div class="line">POWERSTEP01_CONFIG_OC_SD_DISABLE, // Over current shutwdown enabling, enum powerstep01_ConfigOcSd_t</div>
<div class="line">POWERSTEP01_CONFIG_UVLOVAL_LOW, // UVLO Threshold via powerstep01_ConfigUvLoVal_t</div>
<div class="line">POWERSTEP01_CONFIG_VCCVAL_15V, // VCC Val, enum powerstep01_ConfigVccVal_t</div>
<div class="line">POWERSTEP01_CONFIG_TSW_048us, // Switching period, enum powerstep01_ConfigTsw_t</div>
<div class="line">POWERSTEP01_CONFIG_PRED_DISABLE // Predictive current enabling , enum powerstep01_ConfigPredEn_t</div>
</div>
<div class="line">};</div>
</div>
<p>creates a global instance from POWERSTEP01</p>
<blockquote>
<div>POWERSTEP01 motor_NR_spi <strong>&lt;SPI Port&gt;</strong>P<strong>&lt;SSEL Port Name&gt;</strong>_<strong>&lt;SSEL Pin Number&gt;</strong>;</div></blockquote>
<p>creates a global instance from DevSPI</p>
<blockquote>
<div>DevSPI dev_spi_<strong>&lt;name&gt;</strong>(&amp; <strong>&lt;SPI Port&gt;</strong>P<strong>&lt;SSEL Port Name&gt;</strong>_<strong>&lt;SSEL Pin Number&gt;</strong>);</div></blockquote>
<p>and two lines in void &lt;Model Name&gt;_initialize(void) function</p>
<blockquote>
<div><p>motor_NR_spi <strong>&lt;SPI Port&gt;</strong>P<strong>&lt;SSEL Port Name&gt;</strong>_<strong>&lt;SSEL Pin Number&gt;</strong>= new POWERSTEP01(P<strong>&lt;RESET Port Name&gt;</strong>_<strong>&lt;RESET Pin Number&gt;</strong>, P<strong>&lt;SSEL Port Name&gt;</strong>_<strong>&lt;SSEL Pin Number&gt;</strong>, dev_spi_<strong>&lt;name&gt;</strong>);</p>
<p>motor_NR_spi <strong>&lt;SPI Port&gt;</strong>P<strong>&lt;SSEL Port Name&gt;</strong>_<strong>&lt;SSEL Pin Number&gt;</strong>-&gt;Init( initDeviceParameters_<strong>&lt;name&gt;</strong>_motor_NR )</p>
</div></blockquote>
<p>in <strong>&lt;Model Name&gt;</strong>.cpp.</p>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="PowerSTEP01_GetAcceleration_en.html" title="11.1.2. PowerSTEP01_GetAcceleration"
             >next</a> |</li>
        <li class="right" >
          <a href="_PowerSTEP01_en.html" title="11.1. PowerSTEP01"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../Index.html">mbed_target_doc 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="_index_en.html" >11. Motor Driver</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="_PowerSTEP01_en.html" >11.1. PowerSTEP01</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015-2017, CEA/ATM RG, HS Wismar.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>